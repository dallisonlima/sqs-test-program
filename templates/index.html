<!-- index.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend SQS</title>

    <!-- Bootstrap CSS via CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <script>
        function showAlert(message, alertType, messageId, receiptHandle) {
            var alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-' + alertType + ' alert-dismissible fade show';
            alertDiv.setAttribute('role', 'alert');
            alertDiv.innerHTML = '<strong>' + alertType.charAt(0).toUpperCase() + alertType.slice(1) + '!</strong> ' + message;

            if (messageId && receiptHandle) {
                alertDiv.innerHTML += '<button type="button" class="btn btn-danger btn-sm ms-2" onclick="deleteMessage(\'' + messageId + '\', \'' + receiptHandle + '\')">Excluir</button>';
            } else {
                // Adicionar um botão de fechamento apenas se a mensagem não tiver ID
                alertDiv.innerHTML += '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>';

                // Adicionar um event listener para fechar a caixa de mensagem quando o botão Fechar for clicado
                alertDiv.querySelector('.btn-close').addEventListener('click', function () {
                    alertDiv.remove();
                });
            }

            document.getElementById('alerts-container').appendChild(alertDiv);

            // Verificar se a mensagem tem um ID antes de aplicar o temporizador de remoção automática
            if (!messageId) {
                setTimeout(function () {
                    alertDiv.remove();
                }, 3000);
            }

            // Adicionar um event listener para fechar a caixa de mensagem quando o botão Excluir for clicado
            if (messageId && receiptHandle) {
                alertDiv.querySelector('.btn-danger').addEventListener('click', function () {
                    deleteMessage(messageId, receiptHandle);
                    alertDiv.remove();
                });
            }
        }

        function sendMessage() {
            var mensagem = document.getElementById('mensagem').value;
            fetch('/enviar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'mensagem=' + encodeURIComponent(mensagem),
            })
                .then(response => response.text())
                .then(message => showAlert(message, 'success'))
                .catch(error => showAlert('Erro ao enviar mensagem: ' + error, 'danger'));
        }

        function receiveMessage() {
            fetch('/receber')
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        showAlert(data.message, 'info', data.messageId, data.receiptHandle);
                    } else {
                        showAlert('Nenhuma mensagem na fila.', 'info', null, null);
                    }
                })
                .catch(error => showAlert('Erro ao receber mensagem: ' + error, 'danger', null, null));
        }

        function deleteMessage(messageId, receiptHandle) {
            fetch('/deletar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'messageId=' + encodeURIComponent(messageId) + '&receiptHandle=' + encodeURIComponent(receiptHandle),
            })
                .then(response => response.text())
                .then(message => showAlert(message, 'info'))
                .catch(error => showAlert('Erro ao deletar mensagem: ' + error, 'danger'));
        }
    </script>
</head>

<body class="container mt-5">
    <h1 class="mb-4">Interagir com Filas SQS</h1>

    <form action="/enviar" method="post" onsubmit="event.preventDefault(); sendMessage()">
        <div class="mb-3">
            <label for="mensagem" class="form-label">Digite a mensagem que deseja enviar:</label>
            <input type="text" class="form-control" id="mensagem" name="mensagem" required>
        </div>
        <button type="submit" class="btn btn-primary">Enviar</button>
    </form>

    <button type="button" class="btn btn-success mt-3" onclick="receiveMessage()">Receber Mensagem</button>

    <div id="alerts-container" class="mt-3"></div>

    <!-- Bootstrap JS via CDN (opcional, se necessário) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>